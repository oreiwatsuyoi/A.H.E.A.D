<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Receiver - PharmaVigilance</title>
</head>
<body>
    <h1>Webhook Receiver Active</h1>
    <p>This page receives PharmaVigilance webhook events.</p>
    <div id="events"></div>
    
    <script>
        window.addEventListener('message', (event) => {
            if (event.data.event === 'DrugInteraction') {
                console.log('Webhook event received:', event.data);
                
                if (window.opener && !window.opener.closed) {
                    window.opener.postMessage(event.data, '*');
                }
                
                const eventsDiv = document.getElementById('events');
                eventsDiv.innerHTML = `<pre>${JSON.stringify(event.data, null, 2)}</pre>` + eventsDiv.innerHTML;
            }
        });
        
        if (window.location.search.includes('event=')) {
            const params = new URLSearchParams(window.location.search);
            const eventData = {
                event: params.get('event'),
                severity: params.get('severity'),
                details: params.get('details'),
                resource: params.get('resource'),
                resource_id: params.get('resource_id')
            };
            
            if (window.opener && !window.opener.closed) {
                window.opener.postMessage(eventData, '*');
            }
        }
    </script>
</body>
</html>
